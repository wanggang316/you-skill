import { derived } from "svelte/store";
import { settings } from "./stores/settings";

type Dictionary = Record<string, string>;

const translations: Record<string, Dictionary> = {
  en: {
    "header.localTab": "Local Skills",
    "header.remoteTab": "Remote Library",
    "header.add": "Add",
    "header.back": "Back",
    "header.settings": "Settings",
    "local.search.placeholder": "Search local skills",
    "local.agent.all": "All Agents",
    "local.refresh": "Refresh",
    "local.loading": "Scanning local skills...",
    "local.empty": "No local skills found",
    "local.section.appCount": "{count} agent apps installed",
    "local.action.delete": "Delete",
    "remote.search.placeholder": "Search remote skills",
    "remote.search": "Search",
    "remote.loading": "Loading remote skills...",
    "remote.empty": "No remote skills",
    "remote.install": "Install",
    "remote.reinstall": "Reinstall",
    "remote.update": "Update",
    "remote.updating": "Updating...",
    "remote.installed": "Installed",
    "remote.downloading": "Downloading...",
    "remote.loadMore": "Load more",
    "remote.noMore": "No more results",
    "remote.stars": "{count} Stars",
    "remote.total": "Total: {count} skills",
    "settings.language": "Language",
    "settings.theme": "Theme",
    "settings.syncMode": "Skill sync mode",
    "settings.theme.system": "System",
    "settings.theme.light": "Light",
    "settings.theme.dark": "Dark",
    "settings.syncMode.symlink": "Symlink",
    "settings.syncMode.copy": "Copy",
    "settings.about": "Version",
    "settings.checkUpdate": "Version",
    "settings.checkUpdateBtn": "Check Update",
    "settings.checkingUpdate": "Checking...",
    "settings.currentVersion": "v{version}",
    "settings.newVersionAvailable": "v{version} available",
    "settings.installUpdate": "Update",
    "settings.installingUpdate": "Updating...",
    "settings.noUpdateAvailable": "You are using the latest version",
    "settings.updateCheckFailed": "Failed to check for updates",
    "settings.updateInstallFailed": "Failed to install update",
    "header.update": "Update",
    "header.updateAvailable": "Update Available",
    "settings.backup": "Backup",
    "settings.backup.selectFolder": "Select backup folder",
    "settings.backup.backupNow": "Backup Now",
    "settings.backup.backingUp": "Backing up...",
    "settings.backup.lastBackup": "Last backup: {time}",
    "settings.backup.noBackupYet": "No backup yet",
    "settings.backup.openFolder": "Open folder",
    "settings.translation.title": "Translation",
    "settings.translation.apiKey": "OpenRouter API Key",
    "settings.translation.model": "Model",
    "settings.translation.modelHint": "Type to search or pick from OpenRouter model list.",
    "settings.translation.loadingModels": "Loading models...",
    "settings.translation.loadModelsFailed": "Failed to load models, fallback list is shown.",
    "settings.translation.targetLanguage": "Target language",
    "settings.translation.targetLanguageHint": "Use language code or name, for example zh-CN, Japanese.",
    "settings.translation.targetLanguageValue": "Target: {language}",
    "settings.translation.modelValue": "Model: {model}",
    "settings.translation.saving": "Saving...",
    "settings.translation.missingConfigTitle": "Translation settings required",
    "settings.translation.missingConfigDescription":
      "Before translating, please complete the following settings:",
    "confirm.deleteSkill": "Confirm delete {name}? This cannot be undone.",
    "confirm.deleteTitle": "Delete confirmation",
    "addSkill.title": "Add Skill",
    "addSkill.tab.zip": "Compressed File",
    "addSkill.tab.folder": "Folder",
    "addSkill.tab.github": "GitHub",
    "addSkill.zip.description": "Select compressed file containing the skill (.zip/.skill).",
    "addSkill.zip.selectFile": "Click to select compressed file",
    "addSkill.zip.clickToChange": "Click to change file",
    "addSkill.zip.detect": "Detect",
    "addSkill.zip.selectSkill": "Select a skill to install:",
    "addSkill.zip.dropReadError":
      "Could not read the compressed file from drag and drop. Please try click-to-select.",
    "addSkill.zip.invalidCompressedFile":
      "Please select a compressed file in .zip or .skill format.",
    "addSkill.folder.description": "Select folder containing the skill.",
    "addSkill.folder.selectFolder": "Click to select folder",
    "addSkill.folder.clickToChange": "Click to change folder",
    "addSkill.folder.detect": "Detect",
    "addSkill.folder.selectSkill": "Select a skill to install:",
    "addSkill.folder.dropReadError":
      "Could not read the folder from drag and drop. Please drag the folder itself or use click-to-select.",
    "addSkill.github.description": "Enter a GitHub repository URL containing the skill.",
    "addSkill.github.urlPlaceholder": "https://github.com/owner/repo",
    "addSkill.github.detect": "Detect",
    "addSkill.github.selectSkill": "Select a skill to install:",
    "addSkill.noSkillsFound": "No skills found in this repository.",
    "addSkill.selectAgents": "Select agent apps to install to:",
    "addSkill.noProjectsSelected": "Please select at least one project.",
    "addSkill.noAgentsSelected": "Please select at least one app.",
    "addSkill.noZipSelected": "Please select a compressed file.",
    "addSkill.noFolderSelected": "Please select a folder.",
    "addSkill.noSkillSelected": "Please select a skill.",
    "addSkill.cancel": "Cancel",
    "addSkill.installing": "Installing...",
    "addSkill.confirm": "Install",
    "installConfirm.title": 'Install "{name}"',
    "selectAgent.defaultTitle": "Select Apps",
    "selectAgent.description": "Select agent apps to install to:",
    "selectAgent.selectAll": "Select all",
    "selectAgent.selectProjects": "Select projects to install to:",
    "selectAgent.confirm": "Confirm",
    "installScope.global": "Global",
    "installScope.project": "Project",
    "local.sourceSelect.title": 'Select source for "{name}"',
    "local.sourceSelect.description":
      "Detected different source folders for this skill. Choose one as the reinstall source.",
    "local.unknown.confirmTitle": "Take over skill management",
    "local.unknown.confirmManage":
      '"{name}" is not managed by YouSkill yet. Do you want YouSkill to take over and manage it?',
    "local.unknown.pathSelectTitle": 'Select "{name}" version',
    "local.unknown.rememberChoice": "Remember this choice",
    "detail.retry": "Retry",
    "detail.openInBrowser": "Open in browser",
    "detail.catalog": "Catalog",
    "detail.closeCatalog": "Close",
    "detail.unsupportedFile": "This file format is not supported for preview yet.",
    "detail.openSource": "Open source file",
    "detail.openInFileManager": "Open in file manager",
    "detail.translate": "Translate",
    "detail.showOriginal": "Original",
    "detail.showTranslated": "Translation",
    "detail.translating": "Translating...",
    "agentApps.title": "Agent Apps",
    "agentApps.configButton": "Configure",
    "agentApps.userSection": "Custom Apps",
    "agentApps.missingMyApp": "Missing My Agent App?",
    "agentApps.addTitle": "Add Agent App",
    "agentApps.editTitle": "Edit Agent App",
    "agentApps.displayName": "Display Name",
    "agentApps.displayNamePlaceholder": "e.g. My AI Editor",
    "agentApps.globalPath": "Global Path",
    "agentApps.globalPathPlaceholder": "e.g. ~/.myapp/skills",
    "agentApps.selectFolder": "Select Folder",
    "agentApps.projectPath": "Project Path",
    "agentApps.projectPathPlaceholder": "e.g. .myapp/skills",
    "agentApps.add": "Add",
    "agentApps.save": "Save",
    "agentApps.remove": "Remove",
    "agentApps.removeConfirm": "Remove this agent app?",
    "agentApps.edit": "Edit",
    "projectManage.title": "Project Management",
    "projectManage.loading": "Loading projects...",
    "projectManage.empty": "No projects yet",
    "projectManage.addTitle": "Add Project",
    "projectManage.editTitle": "Edit Project",
    "projectManage.name": "Name",
    "projectManage.namePlaceholder": "e.g. my-workspace",
    "projectManage.path": "Path",
    "projectManage.pathPlaceholder": "Select project folder",
    "projectManage.selectFolder": "Select Folder",
    "projectManage.add": "Add",
    "projectManage.save": "Save",
    "projectManage.edit": "Edit",
    "projectManage.remove": "Remove",
    "projectManage.removeConfirm": "Remove project {name}?",
  },
  zh: {
    "header.localTab": "本地技能",
    "header.remoteTab": "远程技能库",
    "header.add": "新增",
    "header.back": "返回",
    "header.settings": "设置",
    "local.search.placeholder": "搜索本地技能",
    "local.agent.all": "全部 Agent",
    "local.refresh": "刷新",
    "local.loading": "正在扫描本地 skill...",
    "local.empty": "未找到本地技能",
    "local.section.appCount": "{count} 个 Agent 应用已安装",
    "local.action.delete": "删除",
    "remote.search.placeholder": "搜索远程技能",
    "remote.search": "搜索",
    "remote.loading": "正在加载技能库...",
    "remote.empty": "暂无技能数据",
    "remote.install": "安装",
    "remote.reinstall": "重新安装",
    "remote.update": "更新",
    "remote.updating": "更新中...",
    "remote.installed": "已安装",
    "remote.downloading": "下载中...",
    "remote.loadMore": "加载更多",
    "remote.noMore": "没有更多了",
    "remote.stars": "{count} Stars",
    "remote.total": "共 {count} 个技能",
    "settings.language": "语言",
    "settings.theme": "主题",
    "settings.syncMode": "Skill 同步方式",
    "settings.theme.system": "跟随主题",
    "settings.theme.light": "浅色",
    "settings.theme.dark": "深色",
    "settings.syncMode.symlink": "软连接",
    "settings.syncMode.copy": "复制",
    "settings.about": "版本",
    "settings.checkUpdate": "版本",
    "settings.checkUpdateBtn": "检查更新",
    "settings.checkingUpdate": "检查中...",
    "settings.currentVersion": "v{version}",
    "settings.newVersionAvailable": "v{version} 可用",
    "settings.installUpdate": "升级",
    "settings.installingUpdate": "升级中...",
    "settings.noUpdateAvailable": "当前已是最新版本",
    "settings.updateCheckFailed": "检查更新失败",
    "settings.updateInstallFailed": "安装更新失败",
    "header.update": "升级",
    "header.updateAvailable": "有新版本可用",
    "settings.backup": "备份",
    "settings.backup.selectFolder": "选择备份文件夹",
    "settings.backup.backupNow": "立即备份",
    "settings.backup.backingUp": "正在备份...",
    "settings.backup.lastBackup": "上次备份：{time}",
    "settings.backup.noBackupYet": "尚未备份",
    "settings.backup.openFolder": "打开文件夹",
    "settings.translation.title": "翻译设置",
    "settings.translation.apiKey": "OpenRouter API Key",
    "settings.translation.model": "模型",
    "settings.translation.modelHint": "可输入搜索或从 OpenRouter 模型列表中选择。",
    "settings.translation.loadingModels": "正在加载模型列表...",
    "settings.translation.loadModelsFailed": "加载模型列表失败，已展示内置候选。",
    "settings.translation.targetLanguage": "目标语言",
    "settings.translation.targetLanguageHint": "支持语言代码或语言名，例如 zh-CN、Japanese。",
    "settings.translation.targetLanguageValue": "目标语言：{language}",
    "settings.translation.modelValue": "模型：{model}",
    "settings.translation.saving": "保存中...",
    "settings.translation.missingConfigTitle": "需要完善翻译设置",
    "settings.translation.missingConfigDescription": "翻译前请先填写以下配置：",
    "confirm.deleteSkill": "确认删除 {name}？此操作不可恢复。",
    "confirm.deleteTitle": "删除确认",
    "addSkill.title": "添加 Skill",
    "addSkill.tab.zip": "压缩文件",
    "addSkill.tab.folder": "文件夹",
    "addSkill.tab.github": "GitHub",
    "addSkill.zip.description": "选择包含 skill 的压缩文件（.zip/.skill）。",
    "addSkill.zip.selectFile": "点击选择压缩文件",
    "addSkill.zip.clickToChange": "点击更换文件",
    "addSkill.zip.detect": "检测",
    "addSkill.zip.selectSkill": "选择要安装的 skill：",
    "addSkill.zip.dropReadError": "无法读取拖入的压缩文件，请改用点击选择。",
    "addSkill.zip.invalidCompressedFile": "请选择 .zip 或 .skill 格式的压缩文件。",
    "addSkill.folder.description": "选择包含 skill 的文件夹。",
    "addSkill.folder.selectFolder": "点击选择文件夹",
    "addSkill.folder.clickToChange": "点击更换文件夹",
    "addSkill.folder.detect": "检测",
    "addSkill.folder.selectSkill": "选择要安装的 skill：",
    "addSkill.folder.dropReadError": "无法读取拖入的文件夹，请拖拽文件夹本身，或改用点击选择。",
    "addSkill.github.description": "输入包含 skill 的 GitHub 仓库地址",
    "addSkill.github.urlPlaceholder": "https://github.com/owner/repo",
    "addSkill.github.detect": "检测",
    "addSkill.github.selectSkill": "选择要安装的 skill：",
    "addSkill.noSkillsFound": "未在此仓库中找到 skill。",
    "addSkill.selectAgents": "选择要安装到的 Agent 应用：",
    "addSkill.noProjectsSelected": "请至少选择一个项目。",
    "addSkill.noAgentsSelected": "请至少选择一个应用。",
    "addSkill.noZipSelected": "请选择一个压缩文件。",
    "addSkill.noFolderSelected": "请选择一个文件夹。",
    "addSkill.noSkillSelected": "请选择一个 skill。",
    "addSkill.cancel": "取消",
    "addSkill.installing": "安装中...",
    "addSkill.confirm": "安装",
    "installConfirm.title": '安装 "{name}"',
    "selectAgent.defaultTitle": "选择应用",
    "selectAgent.description": "选择要安装到的 Agent 应用：",
    "selectAgent.selectAll": "全选",
    "selectAgent.selectProjects": "选择要安装到的项目：",
    "selectAgent.confirm": "确认",
    "installScope.global": "全局",
    "installScope.project": "项目",
    "local.sourceSelect.title": '选择 "{name}" 的来源',
    "local.sourceSelect.description":
      "检测到该 skill 的来源目录内容不一致，请选择一个作为重新安装来源。",
    "local.unknown.confirmTitle": "接管 Skill 管理",
    "local.unknown.confirmManage": '"{name}" 尚未由 YouSkill 管理，是否交给 YouSkill 统一管理？',
    "local.unknown.pathSelectTitle": '选择 "{name}" 版本',
    "local.unknown.rememberChoice": "记住此选择",
    "detail.retry": "重试",
    "detail.openInBrowser": "在浏览器中打开",
    "detail.catalog": "目录",
    "detail.closeCatalog": "关闭",
    "detail.unsupportedFile": "暂不支持预览该文件格式。",
    "detail.openSource": "打开源文件",
    "detail.openInFileManager": "在文件管理器中打开",
    "detail.translate": "原文",
    "detail.showOriginal": "显示原文",
    "detail.showTranslated": "译文",
    "detail.translating": "翻译中...",
    "agentApps.title": "Agent 应用",
    "agentApps.configButton": "配置",
    "agentApps.userSection": "自定义应用",
    "agentApps.missingMyApp": "没有我的 Agent 应用？",
    "agentApps.addTitle": "添加 Agent 应用",
    "agentApps.editTitle": "编辑 Agent 应用",
    "agentApps.displayName": "显示名称",
    "agentApps.displayNamePlaceholder": "例如：My AI Editor",
    "agentApps.globalPath": "全局路径",
    "agentApps.globalPathPlaceholder": "例如：~/.myapp/skills",
    "agentApps.selectFolder": "选择文件夹",
    "agentApps.projectPath": "项目路径",
    "agentApps.projectPathPlaceholder": "例如：.myapp/skills",
    "agentApps.add": "添加",
    "agentApps.save": "保存",
    "agentApps.remove": "移除",
    "agentApps.removeConfirm": "确认移除此 Agent 应用？",
    "agentApps.edit": "编辑",
    "projectManage.title": "项目管理",
    "projectManage.loading": "正在加载项目...",
    "projectManage.empty": "暂无项目",
    "projectManage.addTitle": "添加项目",
    "projectManage.editTitle": "编辑项目",
    "projectManage.name": "名称",
    "projectManage.namePlaceholder": "例如：my-workspace",
    "projectManage.path": "路径",
    "projectManage.pathPlaceholder": "请选择项目目录",
    "projectManage.selectFolder": "选择文件夹",
    "projectManage.add": "添加",
    "projectManage.save": "保存",
    "projectManage.edit": "编辑",
    "projectManage.remove": "删除",
    "projectManage.removeConfirm": "确认删除项目 {name}？",
  },
};

export const t = derived(settings, ($settings) => {
  const language = $settings.language || "en";
  const dict = translations[language] || translations.en;
  return (key: string, params: Record<string, string | number> = {}) => {
    const template = dict[key] || translations.en[key] || key;
    return template.replace(/\{(\w+)\}/g, (_, name) =>
      params[name] === undefined ? "" : String(params[name])
    );
  };
});
