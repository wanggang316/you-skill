import { derived } from "svelte/store";
import { settings } from "./stores/settings";

type Dictionary = Record<string, string>;

const translations: Record<string, Dictionary> = {
  en: {
    "header.subtitle": "Local management and one-click install",
    "header.localTab": "Local Skills",
    "header.remoteTab": "Remote Library",
    "header.add": "Add",
    "header.back": "Back",
    "header.settings": "Settings",
    "header.pendingImport": "Pending Import",
    "view.add.title": "Add scan path",
    "view.add.placeholder": "Add a custom scan path (project root)",
    "view.add.addPath": "Add path",
    "view.add.removePath": "Remove path",
    "local.search.placeholder": "Search local skills or path",
    "local.agent.all": "All Agents",
    "local.refresh": "Refresh",
    "local.loading": "Scanning local skills...",
    "local.empty": "No local skills found",
    "local.section.managed": "My Skills",
    "local.section.managedCount": "{count} apps installed",
    "local.section.emptyManaged": "No managed skills yet",
    "local.section.unmanaged": "Standalone installs (to import)",
    "local.action.importAll": "Import All",
    "local.action.import": "Import",
    "local.action.delete": "Delete",
    "local.action.installToApps": "Install to apps",
    "local.action.confirm": "Confirm",
    "local.action.selectAll": "Select all",
    "local.tag.standalone": "Standalone copy",
    "local.tag.nameConflict": "Duplicate name",
    "local.tag.conflictManaged": "Conflicts with .agents",
    "remote.search.placeholder": "Search remote skills (name or repo)",
    "remote.installGlobal": "Global install",
    "remote.search": "Search",
    "remote.loading": "Loading remote skills...",
    "remote.empty": "No remote skills",
    "remote.install": "Install",
    "remote.openUrl": "Open",
    "remote.installed": "Installed",
    "remote.downloading": "Downloading...",
    "remote.loadMore": "Load more",
    "remote.noMore": "No more results",
    "remote.installs": "{count} installs",
    "remote.stars": "{count} Github Stars",
    "remote.total": "Total: {count} skills",
    "settings.general": "General",
    "settings.general.subtitle": "Language, theme, and sync mode",
    "settings.language": "Language",
    "settings.theme": "Theme",
    "settings.syncMode": "Skill sync mode",
    "settings.theme.system": "System",
    "settings.theme.light": "Light",
    "settings.theme.dark": "Dark",
    "settings.syncMode.symlink": "Symlink",
    "settings.syncMode.copy": "Copy",
    "settings.about": "Version",
    "settings.about.subtitle": "Version and updates",
    "settings.checkUpdate": "Version",
    "settings.checkUpdateBtn": "Check Update",
    "settings.checkingUpdate": "Checking...",
    "settings.updatePlaceholder": "Update service not connected",
    "settings.currentVersion": "v{version}",
    "settings.newVersionAvailable": "v{version} available",
    "settings.installUpdate": "Update",
    "settings.installingUpdate": "Updating...",
    "settings.noUpdateAvailable": "You are using the latest version",
    "settings.updateCheckFailed": "Failed to check for updates",
    "settings.updateInstallFailed": "Failed to install update",
    "header.update": "Update",
    "settings.backup": "Backup",
    "settings.backup.subtitle": "Backup your skills to a safe location",
    "settings.backup.selectFolder": "Select backup folder",
    "settings.backup.backupNow": "Backup Now",
    "settings.backup.backingUp": "Backing up...",
    "settings.backup.lastBackup": "Last backup: {time}",
    "settings.backup.noBackupYet": "No backup yet",
    "settings.backup.openFolder": "Open folder",
    "settings.backup.success": "Backup completed successfully",
    "settings.backup.noFolder": "Please select a backup folder first",
    "settings.apiKey.title": "API Key",
    "settings.apiKey.placeholder": "Enter X-API-Key (optional)",
    "settings.apiKey.save": "Save",
    "settings.apiKey.saved": "API key saved",
    "settings.apiKey.error": "Failed to save API key",
    "error.noSkillAgent": "Unable to determine target app for this skill",
    "confirm.duplicateSkill":
      "A skill with the same name already exists in .agents.\nOK: keep the .agents version\nCancel: keep the current version",
    "confirm.duplicateSkillWithName":
      "A skill with the same name already exists in .agents: {name}\nOK: keep the .agents version\nCancel: keep the current version",
    "confirm.deleteSkill": "Confirm delete {name}? This cannot be undone.",
    "confirm.duplicateTitle": "Duplicate skill",
    "confirm.deleteTitle": "Delete confirmation",
    "addSkill.title": "Add Skill",
    "addSkill.tab.zip": "ZIP File",
    "addSkill.tab.folder": "Folder",
    "addSkill.tab.github": "GitHub",
    "addSkill.zip.description": "Select a ZIP file containing the skill.",
    "addSkill.zip.selectFile": "Click to select ZIP file",
    "addSkill.zip.clickToChange": "Click to change file",
    "addSkill.zip.detect": "Detect",
    "addSkill.zip.selectSkill": "Select a skill to install:",
    "addSkill.folder.description": "Select a skill folder to install.",
    "addSkill.folder.selectFolder": "Click to select folder",
    "addSkill.folder.clickToChange": "Click to change folder",
    "addSkill.folder.detect": "Detect",
    "addSkill.folder.selectSkill": "Select a skill to install:",
    "addSkill.github.description": "Enter a GitHub repository URL to detect skills.",
    "addSkill.github.urlPlaceholder": "https://github.com/owner/repo",
    "addSkill.github.detect": "Detect",
    "addSkill.github.selectSkill": "Select a skill to install:",
    "addSkill.noSkillsFound": "No skills found in this repository.",
    "addSkill.selectAgents": "Select apps to install to:",
    "addSkill.selectAll": "Select all",
    "addSkill.deselectAll": "Deselect all",
    "addSkill.noAgentsSelected": "Please select at least one app.",
    "addSkill.noZipSelected": "Please select a ZIP file.",
    "addSkill.noFolderSelected": "Please select a folder.",
    "addSkill.noSkillSelected": "Please select a skill.",
    "addSkill.cancel": "Cancel",
    "addSkill.confirm": "Confirm",
    "installConfirm.title": 'Install "{name}"',
    "installConfirm.selectAgents": "Select apps to install to:",
    "installConfirm.selectAll": "Select all",
    "installConfirm.skip": "Skip",
    "installConfirm.confirm": "Confirm",
    "selectAgent.defaultTitle": "Select Apps",
    "selectAgent.description": "Select apps to install to:",
    "selectAgent.selectAll": "Select all",
    "selectAgent.cancel": "Cancel",
    "selectAgent.confirm": "Confirm",
    "detail.retry": "Retry",
    "detail.openInBrowser": "Open in browser",
    "detail.openRepo": "Open Repository",
    "pendingImport.title": "Pending Imports",
    "pendingImport.description":
      "You have {count} standalone installed skill(s). We recommend importing them into Your Skills for unified management.",
    "pendingImport.empty": "No pending skills to import",
    "pendingImport.open": "Open",
    "pendingImport.openFolder": "Open folder",
    "local.section.pendingImportPrompt":
      "You have {count} standalone installed skill(s). We recommend importing them into Your Skills for unified management.",
  },
  zh: {
    "header.subtitle": "本地管理与一键安装",
    "header.localTab": "本地技能",
    "header.remoteTab": "远程技能库",
    "header.add": "新增",
    "header.back": "返回",
    "header.settings": "设置",
    "header.pendingImport": "待导入",
    "view.add.title": "新增扫描路径",
    "view.add.placeholder": "添加自定义扫描路径（项目根目录）",
    "view.add.addPath": "添加路径",
    "view.add.removePath": "移除路径",
    "local.search.placeholder": "搜索本地技能或路径",
    "local.agent.all": "全部 Agent",
    "local.refresh": "刷新",
    "local.loading": "正在扫描本地 skill...",
    "local.empty": "未找到本地技能",
    "local.section.managed": "我的 Skills",
    "local.section.managedCount": "共 {count} 个应用安装",
    "local.section.emptyManaged": "暂无统一管理的 skill",
    "local.section.unmanaged": "独立安装（待导入）",
    "local.action.importAll": "一键导入",
    "local.action.import": "导入",
    "local.action.delete": "删除",
    "local.action.installToApps": "安装到应用",
    "local.action.confirm": "确认",
    "local.action.selectAll": "全选",
    "local.tag.standalone": "独立副本",
    "local.tag.nameConflict": "有同名",
    "local.tag.conflictManaged": "与 .agents 重名",
    "remote.search.placeholder": "搜索远程技能（名称或仓库）",
    "remote.installGlobal": "全局安装",
    "remote.search": "搜索",
    "remote.loading": "正在加载技能库...",
    "remote.empty": "暂无技能数据",
    "remote.install": "安装",
    "remote.openUrl": "打开",
    "remote.installed": "已安装",
    "remote.downloading": "下载中...",
    "remote.loadMore": "加载更多",
    "remote.noMore": "没有更多了",
    "remote.installs": "{count} 次安装",
    "remote.stars": "{count} Github Stars",
    "remote.total": "共 {count} 个技能",
    "settings.general": "通用",
    "settings.general.subtitle": "语言、主题与同步方式",
    "settings.language": "语言",
    "settings.theme": "主题",
    "settings.syncMode": "Skill 同步方式",
    "settings.theme.system": "跟随主题",
    "settings.theme.light": "浅色",
    "settings.theme.dark": "深色",
    "settings.syncMode.symlink": "软连接",
    "settings.syncMode.copy": "复制",
    "settings.about": "版本",
    "settings.about.subtitle": "版本与更新",
    "settings.checkUpdate": "版本",
    "settings.checkUpdateBtn": "检查更新",
    "settings.checkingUpdate": "检查中...",
    "settings.updatePlaceholder": "暂未接入更新服务",
    "settings.currentVersion": "v{version}",
    "settings.newVersionAvailable": "v{version} 可用",
    "settings.installUpdate": "升级",
    "settings.installingUpdate": "升级中...",
    "settings.noUpdateAvailable": "当前已是最新版本",
    "settings.updateCheckFailed": "检查更新失败",
    "settings.updateInstallFailed": "安装更新失败",
    "header.update": "升级",
    "settings.backup": "备份",
    "settings.backup.subtitle": "将您的技能备份到安全位置",
    "settings.backup.selectFolder": "选择备份文件夹",
    "settings.backup.backupNow": "立即备份",
    "settings.backup.backingUp": "正在备份...",
    "settings.backup.lastBackup": "上次备份：{time}",
    "settings.backup.noBackupYet": "尚未备份",
    "settings.backup.openFolder": "打开文件夹",
    "settings.backup.success": "备份成功",
    "settings.backup.noFolder": "请先选择备份文件夹",
    "settings.apiKey.title": "API Key",
    "settings.apiKey.placeholder": "输入 X-API-Key（可选）",
    "settings.apiKey.save": "保存",
    "settings.apiKey.saved": "API key 已保存",
    "settings.apiKey.error": "保存失败",
    "error.noSkillAgent": "无法识别当前 skill 的应用信息",
    "confirm.duplicateSkill":
      "检测到 .agents 下已存在同名 skill。\n确定：保留 .agents 版本\n取消：保留当前版本",
    "confirm.duplicateSkillWithName":
      "检测到 .agents 下已存在同名 skill：{name}\n确定：保留 .agents 版本\n取消：保留当前版本",
    "confirm.deleteSkill": "确认删除 {name}？此操作不可恢复。",
    "confirm.duplicateTitle": "重复技能",
    "confirm.deleteTitle": "删除确认",
    "addSkill.title": "添加 Skill",
    "addSkill.tab.zip": "ZIP 文件",
    "addSkill.tab.folder": "文件夹",
    "addSkill.tab.github": "GitHub",
    "addSkill.zip.description": "选择一个包含 skill 的 ZIP 文件。",
    "addSkill.zip.selectFile": "点击选择 ZIP 文件",
    "addSkill.zip.clickToChange": "点击更换文件",
    "addSkill.zip.detect": "检测",
    "addSkill.zip.selectSkill": "选择要安装的 skill：",
    "addSkill.folder.description": "选择一个包含 skill 的文件夹。",
    "addSkill.folder.selectFolder": "点击选择文件夹",
    "addSkill.folder.clickToChange": "点击更换文件夹",
    "addSkill.folder.detect": "检测",
    "addSkill.folder.selectSkill": "选择要安装的 skill：",
    "addSkill.github.description": "输入 GitHub 仓库地址来检测 skills。",
    "addSkill.github.urlPlaceholder": "https://github.com/owner/repo",
    "addSkill.github.detect": "检测",
    "addSkill.github.selectSkill": "选择要安装的 skill：",
    "addSkill.noSkillsFound": "未在此仓库中找到 skill。",
    "addSkill.selectAgents": "选择要安装到的应用：",
    "addSkill.selectAll": "全选",
    "addSkill.deselectAll": "取消全选",
    "addSkill.noAgentsSelected": "请至少选择一个应用。",
    "addSkill.noZipSelected": "请选择一个 ZIP 文件。",
    "addSkill.noFolderSelected": "请选择一个文件夹。",
    "addSkill.noSkillSelected": "请选择一个 skill。",
    "addSkill.cancel": "取消",
    "addSkill.confirm": "确认",
    "installConfirm.title": '安装 "{name}"',
    "installConfirm.selectAgents": "选择要安装到的应用：",
    "installConfirm.selectAll": "全选",
    "installConfirm.skip": "暂不安装",
    "installConfirm.confirm": "确认安装",
    "selectAgent.defaultTitle": "选择应用",
    "selectAgent.description": "选择要安装到的应用：",
    "selectAgent.selectAll": "全选",
    "selectAgent.cancel": "取消",
    "selectAgent.confirm": "确认",
    "detail.retry": "重试",
    "detail.openInBrowser": "在浏览器中打开",
    "detail.openRepo": "打开仓库",
    "pendingImport.title": "待导入 Skills",
    "pendingImport.description":
      "你有 {count} 个独立安装的 skill，建议导入到 Your Skills 统一进行管理。",
    "pendingImport.empty": "暂无待导入的 skill",
    "pendingImport.open": "打开",
    "pendingImport.openFolder": "打开文件夹",
    "local.section.pendingImportPrompt":
      "你有 {count} 个独立安装的 skill，建议导入到 Your Skills 统一进行管理。",
  },
};

export const t = derived(settings, ($settings) => {
  const language = $settings.language || "en";
  const dict = translations[language] || translations.en;
  return (key: string, params: Record<string, string | number> = {}) => {
    const template = dict[key] || translations.en[key] || key;
    return template.replace(/\{(\w+)\}/g, (_, name) =>
      params[name] === undefined ? "" : String(params[name])
    );
  };
});
